---
- name: create openvpn config
  template:
    src: server.conf.j2
    dest: /etc/openvpn/server.conf
    backup: yes
  notify:
    - restart openvpn

- name: generate pem file
  command: >
    openssl dhparam
    -out /etc/openvpn/dh{{ ssl_key_bit_length }}.pem
    {{ ssl_key_bit_length }}
  args:
    creates: /etc/openvpn/dh{{ ssl_key_bit_length }}.pem

- name: enable ipv4 forwarding
  sysctl:
    name: net.ipv4.ip_forward
    value: 1
  changed_when: false

- name: start openvpn server
  service:
    name: openvpn
    state: started
    enabled: yes
    args: "{{ssl_key_server_name}}"
